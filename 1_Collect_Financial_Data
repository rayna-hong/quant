import csv
from io import BytesIO
import requests
import pandas as pd

gen_otp_url = 'http://data.krx.co.kr/comm/fileDn/GenerateOTP/generate.cmd'
down_url    = 'http://data.krx.co.kr/comm/fileDn/download_csv/download.cmd'
otp_data = {
    'mktId' : 'STK',
    'trdDd' : '20220412',
    'money' : '1',
    'csvxls_isNo' : 'false',
    'name'  : 'fileDown',
    'url'   : 'dbms/MDC/STAT/standard/MDCSTAT03901'
}
headers = {'Referer' : 'http://data.krx.co.kr/contents/MDC/MDI/mdiLoader'}

otp = requests.post(gen_otp_url, otp_data, headers=headers).text

down_sector_KS = requests.post(down_url, {'code' : otp}, headers=headers)
sector_KS = pd.read_csv(BytesIO(down_sector_KS.content), encoding='EUC-KR')

print(sector_KS)
